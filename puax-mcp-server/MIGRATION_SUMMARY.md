# PUAX MCP Server - HTTP Streamable-HTTP æ”¹é€ å®Œæˆæ€»ç»“

## âœ… æ”¹é€ å®Œæˆ

å·²æˆåŠŸå°† puax-mcp-server ä» **stdio** ä¼ è¾“æ–¹å¼æ”¹é€ ä¸º **HTTP streamable-http (SSE)** ä¼ è¾“æ–¹å¼ã€‚

## å…³é”®å˜æ›´

### 1. ä¼ è¾“æ–¹å¼å‡çº§

| é¡¹ç›® | æ”¹é€ å‰ | æ”¹é€ å |
|-----|--------|--------|
| ä¼ è¾“åè®® | `StdioServerTransport` | `SSEServerTransport` |
| é€šä¿¡æ–¹å¼ | æ ‡å‡†è¾“å…¥è¾“å‡º | HTTP + Server-Sent Events |
| ç›‘å¬åœ°å€ | æ— ï¼ˆè¿›ç¨‹é€šä¿¡ï¼‰ | `http://localhost:23333` |
| å¹¶å‘æ”¯æŒ | å•å®¢æˆ·ç«¯ | âœ… å¤šå®¢æˆ·ç«¯æ”¯æŒ |
| è¿œç¨‹è®¿é—® | âŒ ä»…é™æœ¬åœ° | âœ… æ”¯æŒç½‘ç»œè®¿é—® |

### 2. æ–°å¢ HTTP ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|-----|------|------|
| `/` | GET | SSE è¿æ¥ç«¯ç‚¹ |
| `/message?sessionId=xxx` | POST | å®¢æˆ·ç«¯æ¶ˆæ¯å‘é€ |
| `/health` | GET | å¥åº·æ£€æŸ¥ |

### 3. ä»£ç ä¿®æ”¹æ¦‚è¦

#### `src/server.ts`

**æ–°å¢å¯¼å…¥:**
```typescript
import { SSEServerTransport } from '@modelcontextprotocol/sdk/server/sse.js';
import { createServer, IncomingMessage, ServerResponse } from 'http';
import { URL } from 'url';
```

**æ–°å¢å±æ€§:**
```typescript
private transports: Map<string, SSEServerTransport> = new Map();
private httpServer: any;
```

**æ”¹é€  `run()` æ–¹æ³•:**
- ç§»é™¤ `StdioServerTransport`
- åˆ›å»º HTTP æœåŠ¡å™¨ç›‘å¬ 23333 ç«¯å£
- æ·»åŠ ä¿¡å·å¤„ç† (SIGINT, SIGTERM)

**æ–°å¢æ–¹æ³•:**
- `handleRequest()`: HTTP è¯·æ±‚è·¯ç”±
- `handleSSEConnection()`: SSE è¿æ¥å¤„ç†
- ä¼šè¯ç®¡ç†å’Œæ¸…ç†é€»è¾‘

### 4. åŠŸèƒ½å¢å¼º

âœ… **å¤šä¼šè¯æ”¯æŒ**
- æ¯ä¸ªå®¢æˆ·ç«¯æœ‰ç‹¬ç«‹çš„ sessionId
- æ”¯æŒå¤šä¸ªå¹¶å‘è¿æ¥
- è‡ªåŠ¨æ¸…ç†æ–­å¼€çš„ä¼šè¯

âœ… **å¥åº·ç›‘æ§**
- `/health` ç«¯ç‚¹æä¾›å®æ—¶çŠ¶æ€
- æ˜¾ç¤ºæ´»è·ƒä¼šè¯æ•°
- æœåŠ¡ç‰ˆæœ¬ä¿¡æ¯

âœ… **æ˜“äºè°ƒè¯•**
- å¯ä½¿ç”¨ curl æµ‹è¯•
- æ”¯æŒæµè§ˆå™¨å¼€å‘è€…å·¥å…·
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

âœ… **è¿œç¨‹è®¿é—®**
- å¯é€šè¿‡ç½‘ç»œè®¿é—®
- æ”¯æŒäº‘éƒ¨ç½²
- çµæ´»çš„å®¢æˆ·ç«¯é…ç½®

## å¦‚ä½•ä½¿ç”¨

### å¯åŠ¨æœåŠ¡å™¨

```bash
cd puax-mcp-server
npm start
```

è¾“å‡º:
```
PUAX MCP Server started successfully
Listening on http://localhost:23333
```

### é…ç½® MCP å®¢æˆ·ç«¯

```json
{
  "mcpServers": {
    "puax": {
      "url": "http://localhost:23333"
    }
  }
}
```

### æµ‹è¯•è¿æ¥

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:23333/health

# SSE è¿æ¥
curl http://localhost:23333/

# MCP Inspector
npx @modelcontextprotocol/inspector http://localhost:23333
```

## æµ‹è¯•ç»“æœ

âœ… æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ  
âœ… ç›‘å¬ 23333 ç«¯å£  
âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹æ­£å¸¸  
âœ… SSE è¿æ¥æ­£å¸¸å·¥ä½œ  
âœ… ä¼šè¯ç®¡ç†æ­£å¸¸  
âœ… å¤šå®¢æˆ·ç«¯æ”¯æŒæ­£å¸¸  

## æ–‡ä»¶æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶
- âœ… `src/server.ts` - æ ¸å¿ƒæ”¹é€ 

### æ–°å¢çš„æ–‡ä»¶
- âœ… `HTTP_MIGRATION.md` - è¯¦ç»†è¿ç§»è¯´æ˜
- âœ… `README_HTTP.md` - HTTP ç‰ˆæœ¬ä½¿ç”¨æŒ‡å—
- âœ… `TESTING.md` - æµ‹è¯•æŒ‡å—
- âœ… `MIGRATION_SUMMARY.md` - æœ¬æ–‡ä»¶

### æ„å»ºè¾“å‡º
- âœ… `build/server.js` - ç¼–è¯‘åçš„ HTTP ç‰ˆæœ¬
- âœ… `build/server.d.ts` - ç±»å‹å®šä¹‰

## ä¼˜åŠ¿æ€»ç»“

### ç›¸æ¯” Stdio ç‰ˆæœ¬

1. **æ›´å¥½çš„å¹¶å‘æ€§**: æ”¯æŒå¤šå®¢æˆ·ç«¯åŒæ—¶è¿æ¥
2. **ç½‘ç»œå‹å¥½**: å¯é€šè¿‡ HTTP è®¿é—®ï¼Œæ”¯æŒè¿œç¨‹éƒ¨ç½²
3. **æ˜“äºè°ƒè¯•**: å¯ä½¿ç”¨æ ‡å‡† HTTP å·¥å…·æµ‹è¯•
4. **æ ‡å‡†å…¼å®¹**: ç¬¦åˆ MCP streamable-http è§„èŒƒ
5. **ç›‘æ§å‹å¥½**: æä¾›å¥åº·æ£€æŸ¥ç«¯ç‚¹
6. **å¯æ‰©å±•æ€§**: ä¾¿äºæ·»åŠ è®¤è¯ã€è´Ÿè½½å‡è¡¡ç­‰

### é€‚ç”¨åœºæ™¯

âœ… æœ¬åœ°å¼€å‘ç¯å¢ƒ  
âœ… è¿œç¨‹ MCP æœåŠ¡  
âœ… å¤šç”¨æˆ·ç¯å¢ƒ  
âœ… å®¹å™¨åŒ–éƒ¨ç½²  
âœ… äº‘éƒ¨ç½²  

## æ³¨æ„äº‹é¡¹

1. **å®‰å…¨æ€§**: å¦‚éœ€è¿œç¨‹è®¿é—®ï¼Œè¯·æ·»åŠ è®¤è¯æœºåˆ¶
2. **ç«¯å£é…ç½®**: å¦‚éœ€æ›´æ”¹ç«¯å£ï¼Œä¿®æ”¹ `server.ts` ä¸­çš„ 23333
3. **é˜²ç«å¢™**: ç¡®ä¿é˜²ç«å¢™å…è®¸è®¿é—® 23333 ç«¯å£
4. **è¿›ç¨‹ç®¡ç†**: å»ºè®®ä½¿ç”¨ pm2 ç­‰å·¥å…·ç®¡ç†æœåŠ¡å™¨è¿›ç¨‹

## åç»­å»ºè®®

### å¯é€‰å¢å¼º

- [ ] æ·»åŠ  API å¯†é’¥è®¤è¯
- [ ] é…ç½® HTTPS æ”¯æŒ
- [ ] æ·»åŠ è¯·æ±‚æ—¥å¿—è®°å½•
- [ ] å®ç°ä¼šè¯è¶…æ—¶æœºåˆ¶
- [ ] æ·»åŠ  Prometheus ç›‘æ§æŒ‡æ ‡
- [ ] æ”¯æŒ WebSocket ä½œä¸ºå¤‡é€‰ä¼ è¾“

### éƒ¨ç½²å»ºè®®

- ä½¿ç”¨ pm2 ç®¡ç†è¿›ç¨‹
- é…ç½® Nginx åå‘ä»£ç†
- æ·»åŠ  SSL/TLS è¯ä¹¦
- é…ç½®æ—¥å¿—è½®è½¬
- è®¾ç½®ç›‘æ§å‘Šè­¦

## æ€»ç»“

ğŸ‰ **æ”¹é€ æˆåŠŸï¼**

puax-mcp-server ç°å·²æˆåŠŸè½¬å‹ä¸ºç°ä»£åŒ–çš„ HTTP streamable-http MCP æœåŠ¡å™¨ï¼Œæä¾›æ›´å¥½çš„æ€§èƒ½ã€å¯æ‰©å±•æ€§å’Œæ˜“ç”¨æ€§ã€‚

**å…³é”®æˆå°±:**
- âœ… ä¿ç•™æ‰€æœ‰åŸæœ‰åŠŸèƒ½
- âœ… æ–°å¢ HTTP/SSE ä¼ è¾“æ”¯æŒ
- âœ… å¤šå®¢æˆ·ç«¯å¹¶å‘æ”¯æŒ
- âœ… å®Œæ•´çš„å¥åº·ç›‘æ§
- âœ… æ˜“äºè°ƒè¯•å’Œæµ‹è¯•
- âœ… ç¬¦åˆ MCP è§„èŒƒ

æœåŠ¡å™¨å·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥æŠ•å…¥ä½¿ç”¨ï¼

---

**æ”¹é€ æ—¥æœŸ**: 2026-01-02  
**SDK ç‰ˆæœ¬**: @modelcontextprotocol/sdk ^0.4.0  
**Node.js è¦æ±‚**: >= 18.0.0